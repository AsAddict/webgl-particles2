<!DOCTYPE html>
<html>
<head>
    <title>Test</title>
</head>
<body>
</body>

<script type="text/javascript" src="js/lib/jquery-2.1.3.min.js"></script>
<script type="text/javascript" src="js/lib/three70.js"></script>
<script type="text/javascript" src="js/lib/CopyShader.js"></script>
<script type="text/javascript" src="js/src/Utils.js"></script>
<script type="text/javascript" src="js/src/ShaderPass.js"></script>
<script type="text/javascript" src="js/src/UVMapper.js"></script>
<script type="text/javascript" src="js/src/shaders/UVMapShader.js"></script>

<script type="text/javascript">

var renderer = new THREE.WebGLRenderer({
    alpha: false,
    depth: true,
    stencil: false,
});
renderer.setSize( window.innerWidth, window.innerHeight );
renderer.autoClear = false;
renderer.setClearColor(0x888888, 1);
document.body.appendChild( renderer.domElement );

var scene = new THREE.Scene();
var camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 1, 10);
camera.position.z = 5;

var material = new THREE.MeshBasicMaterial( { color: 0xff0000, wireframe: true } );
// scene.add(new THREE.Mesh(
//     new THREE.SphereGeometry(1),
//     material
// ));
// renderer.clear();
// renderer.render(scene, camera);

// mapping setup
var mapper = new UVMapper(renderer);
var target = mapper.createTarget(256);

var copyPass = new ShaderPass(THREE.CopyShader);
copyPass.material.uniforms.tDiffuse.value = target;


// load model
var loader = new THREE.JSONLoader( true );
loader.load( "models/horse.js", function(geometry) {
    mesh = new THREE.MorphAnimMesh(geometry, new THREE.MeshBasicMaterial({ color: 0x00ff00, wireframe: true, morphTargets:true }));
    mesh.scale.set(0.01,0.01,0.01);
    // scene.add(mesh);

    update();
} );

function update() {
    mesh.updateAnimation(10);

    mapper.render(mesh, target);
    copyPass.render(renderer);

    // renderer.clear();
    // renderer.render(scene, camera);

    requestAnimationFrame(update);
}

// var url = "obj/suzanne.obj";
// var loader = new THREE.OBJLoader();
// loader.load(url, function (object) {
//     var mesh = object.children[0];

//     var mapper = new UVMapper(renderer);
//     var target = mapper.createMap(mesh, 256);

//     var copyPass = new ShaderPass(THREE.CopyShader);
//     copyPass.material.uniforms.tDiffuse.value = target;
//     copyPass.render(renderer);
// });

</script>

</html>